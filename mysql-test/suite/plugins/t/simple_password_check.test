--source include/not_embedded.inc

if (!$SIMPLE_PASSWORD_CHECK_SO) {
  skip No SIMPLE_PASSWORD_CHECK plugin;
}

install soname "simple_password_check";

--vertical_results
--replace_result .dll .so
select * from information_schema.plugins where plugin_name='simple_password_check';

select * from information_schema.system_variables where variable_name like 'simple_password_check%' order by 1;
--horizontal_results

--error ER_NOT_VALID_PASSWORD
create user foo1 identified by 'pwd';

--error ER_NOT_VALID_PASSWORD
grant select on *.* to foo1 identified by 'pwd';

--error ER_NOT_VALID_PASSWORD
grant select on *.* to `FooBar1!` identified by 'FooBar1!';

grant select on *.* to `BarFoo1!` identified by 'FooBar1!';
drop user `BarFoo1!`;

create user foo1 identified by 'aA.12345';
drop user foo1;

set global simple_password_check_digits=3;
set global simple_password_check_letters_same_case=3;
set global simple_password_check_other_characters=3;
show variables like 'simple_password_check_%';

create user foo1 identified by '123:qwe:ASD!';
drop user foo1;

--error ER_NOT_VALID_PASSWORD
create user foo1 identified by '-23:qwe:ASD!';

--error ER_NOT_VALID_PASSWORD
create user foo1 identified by '123:4we:ASD!';

--error ER_NOT_VALID_PASSWORD
create user foo1 identified by '123:qwe:4SD!';

--error ER_NOT_VALID_PASSWORD
create user foo1 identified by '123:qwe:ASD4';

uninstall plugin simple_password_check;

create user foo1 identified by 'pwd';
drop user foo1;

